<workflow-app name="${workflowName}" xmlns="uri:oozie:workflow:0.5">

    <global>
        <job-tracker>${jobTracker}</job-tracker>
        <name-node>${nameNode}</name-node>
        <configuration>
            <property>
                <name>oozie.action.sharelib.for.pig</name>
                <value>pig,hcatalog</value>
            </property>
            <property>
                <name>mapreduce.job.queue.name</name>
                <value>${yarnQueue}</value>
            </property>
            <property>
                <name>hive.metastore.uris</name>
                <value>${hiveMetastoreUris}</value>
            </property>
        </configuration>
    </global>

    <!-- Oozie starting action -->
    <start to="create_table"/>

    <!-- Hive action (CREATE TABLE) -->
    <action name="create_table">
        <hive xmlns="uri:oozie:hive-action:0.5">
            <script>lib/aa.sql</script>
            <param>db=${db}</param>
            <param>output_table=${output_table}</param>
        </hive>
        <ok to="pig_job"/>
        <error to="kill"/>
    </action>

    <!-- Pig action (PROCESS DATA) -->
    <action name="pig_job">
        <pig>
            <script>${pigScript}</script>
            <param>param1=VAMOS</param>
            <param>db=${db}</param>
            <param>output_table=${output_table}</param>
        </pig>
        <ok to="invalidate_metadata"/>
        <error to="kill"/>
    </action>

    <!-- Shell action (INVALIDATE METADATA) -->
    <action name="invalidate_metadata">
        <shell xmlns="uri:oozie:shell-action:0.2">
            <exec>lib/invalidate_metadata.sh</exec>
            <argument>${db}</argument>
            <argument>${output_table}</argument>
            <capture-output/>
        </shell>
        <ok to="end"/>
        <error to="kill"/>
    </action>

    <!-- Kill node (mandatory) -->
    <kill name="kill">
        <message>Action failed, error message[${wf:errorMessage(wf:lastErrorNode())}]</message>
    </kill>

    <!-- End node (mandatory) -->
    <end name="end"/>

</workflow-app>